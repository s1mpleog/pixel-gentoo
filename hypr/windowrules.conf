# --------------------------------------------------
# Global rules
# --------------------------------------------------
windowrule {
    name = nofocus-empty-xwayland
    no_focus = on
    match:class = ^$
    match:title = ^$
    match:xwayland = 1
    match:float = on
    match:fullscreen = 0
    match:pin = 0
}

# --------------------------------------------------
# Floating apps
# --------------------------------------------------
windowrule {
    name = float-yazi-imv-mpv
    size = 1000 700
    center = true
    float = on
    match:class = ^(yazi|imv|mpv)$
}

windowrule {
    name = center-pavucontrol
    center = on
    size = 800 600
    match:class = ^(org.pulseaudio.pavucontrol)$
}

windowrule {
    name = workspace-spotify
    workspace = special:music silent  # opens without stealing focus
    match:class = ^([Ss]potify)$
}

windowrule {
    name = float-clipse
    float = on
    center = on
    size = 622 652
    match:class = ^(clipse)$
}

windowrule {
    name = float-network-configure
    float = on
    size = 840 700
    match:title = ^(network_configure)$
}

windowrule {
    name = float-yazi-sized
    size = 1200 720
    match:class = ^(yazi)$
}

windowrule {
    name = float-mpv-sized
    size = 1200 720
    match:class = ^(mpv)$
}

windowrule {
    name = stay-focused-auth
    stay_focused = on
    match:class = ^(pinentry-.*|org.kde.polkit-kde-authentication-agent-1)$
}

# Float Steam dialogs/popups but not main window
windowrule {
    name = float-steam-popups
    float = on
    match:class = ^([Ss]team)$
    match:title = negative:^(Steam)$
}

# Better visuals/performance for games
windowrule {
    name = game-fullscreen-optimizations
    no_blur = on
    opacity = 1.0 override 1.0 override 1.0 override
    match:fullscreen = 1
}

# Optional: Slightly higher opacity for Steam client
windowrule {
    name = opacity-steam-higher
    opacity = 0.85 override 0.85 override 1.0 override
    match:class = ^([Ss]team|steamwebhelper)$
}

windowrule {
    name = float-discord
    float = on
    match:class = ^(discord|Vesktop|com.discordapp.Discord)$
}

windowrule {
    name = idleinhibit-fullscreen
    idle_inhibit = always  # or "focus" / "fullscreen"
    match:fullscreen = 1
}

windowrule {
    name = no-blur-firefox
    no_blur = on
    match:class = ^(firefox|firefox-nightly)$
}

# --------------------------------------------------
# Dolphin dialogs
# --------------------------------------------------
windowrule {
    name = float-dolphin-progress
    float = on
    match:class = ^(org.kde.dolphin)$
    match:title = ^(Progress Dialog — Dolphin)$
}

windowrule {
    name = float-dolphin-copying
    float = on
    match:class = ^(org.kde.dolphin)$
    match:title = ^(Copying — Dolphin)$
}

# --------------------------------------------------
# Firefox dialogs
# --------------------------------------------------
windowrule {
    name = float-firefox-about
    float = on
    match:initial_title = ^(About Mozilla Firefox)$
}

windowrule {
    name = float-firefox-pip
    float = on
    match:class = ^(firefox|firefox-nightly)$
    match:title = ^(Picture-in-Picture)$
}

windowrule {
    name = float-firefox-library
    float = on
    match:class = ^(firefox|firefox-nightly)$
    match:title = ^(Library)$
}

# --------------------------------------------------
# Terminal monitors
# --------------------------------------------------
windowrule {
    name = float-kitty-monitors
    float = on
    match:class = ^(kitty)$
    match:title = ^(top|btop|htop)$
}

# --------------------------------------------------
# Utility apps
# --------------------------------------------------
windowrule {
    name = float-utilities-group1
    float = on
    size = 1000 700
    center = true
    match:class = ^(vlc|kvantummanager|qt5ct|qt6ct|nwg-look|org.kde.ark|org.pulseaudio.pavucontrol|blueman-manager|nm-applet|nm-connection-editor|org.kde.polkit-kde-authentication-agent-1)$
}

windowrule {
    name = float-utilities-group2
    float = on
    match:class = ^(Signal|com.github.rafostar.Clapper|app.drey.Warp|net.davidotek.pupgui2|yad|eog|io.github.alainm23.planify|io.gitlab.theevilskeleton.Upscaler|com.github.unrud.VideoDownloader|io.gitlab.adhami3310.Impression|io.missioncenter.MissionCenter)$
}

# --------------------------------------------------
# File dialogs / portals
# --------------------------------------------------
# --------------------------------------------------
# Firefox Save As / Download location dialog
# --------------------------------------------------
windowrule {
    name = float-save-as-firefox
    float = on          # Ensure floating (redundant but safe)
    size = 1000 700     # Adjust to your preference/screen (e.g., 1200 800 if you want wider)
    center = on         # Centers it on the current monitor
    match:class = ^(firefox|firefox-nightly)$
    match:title = ^(Save (Image|As|Page)$
    match:initial_title = ^(Save As)$
}

# Optional: Also handle "Enter name of file to save to…" (older Firefox versions or some cases)
windowrule {
    name = float-save-to-firefox
    float = on
    size = 1000 700
    center = on
    match:class = ^(firefox|firefox-nightly)$
    match:initial_title = ^(Enter name of file to save to)
}

windowrule {
    name = float-file-replace-confirm
    float = on
    match:initial_title = ^(Confirm to replace files)$
}

windowrule {
    name = float-file-operation-progress
    float = on
    match:initial_title = ^(File Operation Progress)$
}

windowrule {
    name = float-xdg-portal-gtk
    float = on
    match:class = ^(xdg-desktop-portal-gtk)$
}

# --------------------------------------------------
# Opacity rules (added "override" for exact values instead of multipliers)
# --------------------------------------------------
# Browsers - slightly reduced opacity
windowrule {
    name = opacity-firefox
    opacity = 1.0 override 1.0 override 1.0 override
    match:class = ^(firefox)$
}

windowrule {
    name = opacity-brave
    opacity = 1.0 override 1.0 override 1.0 override
    match:class = ^(Brave-browser)$
}

# Editors / IDEs
windowrule {
    name = opacity-vscodium
    opacity = 0.90 override 0.90 override 1.0 override
    match:class = ^(code-oss)$
}

windowrule {
    name = opacity-zed
    opacity = 0.95 override 0.95 override 1.0 override
    match:class = ^(dev.zed.Zed)$
}

windowrule {
    name = opacity-vscode-variants
    opacity = 0.90 override 0.90 override 1.0 override
    match:class = ^([Cc]ode|code-url-handler|code-insiders-url-handler)$
}

# Terminals
windowrule {
    name = opacity-terminals
    opacity = 0.95 override 0.95 override 1.0 override
    match:class = ^(kitty|Alacritty|clipse|org.wezfurlong.wezterm|com.mitchellh.ghostty)$
}

# Launchers / Menus
windowrule {
    name = opacity-wofi
    opacity = 0.90 override 0.90 override 1.0 override
    match:class = ^(wofi)$
}

# File managers & config tools
windowrule {
    name = opacity-filemanagers-config
    opacity = 0.97 override 0.97 override 1.0 override
    match:class = ^(org.kde.dolphin|thunar|org.kde.ark|nwg-look|qt5ct|qt6ct|kvantummanager)$
}

# System / audio / network utilities
windowrule {
    name = opacity-system-utils
    opacity = 0.95 override 0.95 override 1.0 override
    match:class = ^(org.pulseaudio.pavucontrol|blueman-manager|nm-applet|nm-connection-editor)$
}

# Authentication agents
windowrule {
    name = opacity-auth-agents
    opacity = 0.90 override 0.90 override 1.0 override
    match:class = ^(org.kde.polkit-kde-authentication-agent-1|polkit-gnome-authentication-agent-1)$
}

# Portals
windowrule {
    name = opacity-portals
    opacity = 0.80 override 0.70 override 1.0 override
    match:class = ^(org\.freedesktop\.impl\.portal\.desktop\.(gtk|hyprland))$
}

# Gaming / Streaming
windowrule {
    name = opacity-steam
    opacity = 0.90 override 0.90 override 1.0 override
    match:class = ^([Ss]team|steamwebhelper)$
}

# Music
windowrule {
    name = opacity-spotify
    opacity = 0.70 override 0.70 override 1.0 override
    match:class = ^([Ss]potify)$
}

#file managers
windowrule {
    name = thunar
    opacity = 0.95 override 0.95 override 1.0 override
    match:class = ^(thunar)$
}

windowrule {
    name = yazi
    opacity = 0.95 override 0.95 override 1.0 override
    match:class = ^(yazi)$
}


windowrule {
    name = opacity-spotify-title
    opacity = 0.70 override 0.70 override 1.0 override
    match:initial_title = ^(Spotify (Free|Premium))$
}

# Miscellaneous apps (chat, downloaders, tools, etc.)
windowrule {
    name = opacity-misc-apps
    opacity = 0.95 override 0.95 override 1.0 override
    match:class = ^(com\.github\.rafostar\.Clapper|com\.github\.tchx84\.Flatseal|hu\.kramo\.Cartridges|com\.obsproject\.Studio|gnome-boxes|vesktop|discord|WebCord|ArmCord|app\.drey\.Warp|net\.davidotek\.pupgui2|yad|Signal|io\.github\.alainm23\.planify|io\.gitlab\.theevilskeleton\.Upscaler|com\.github\.unrud\.VideoDownloader|io\.gitlab\.adhami3310\.Impression|io\.missioncenter\.MissionCenter|io\.github\.flattool\.Warehouse)$
}

windowrule {
    name = force-full-opacity-override
    opacity = 1.0 override 1.0 override 1.0 override
    match:class = .*
}

# =============================================
# Tearing / low-latency immediate present for games
# (requires general:allow_tearing = true in hyprland.conf)
# =============================================

windowrule = immediate on, match:class ^(cs2)$
windowrule = immediate on, match:class ^(steam_app_\d+)$
windowrule = immediate on, match:title ^(The Witcher 3)$
windowrule = immediate on, match:class ^(steam_app_3564740)$
# --------------------------------------------------
# Layer rules (unchanged & valid)
# --------------------------------------------------

# Simple blur (uses global decoration:blur { size/passes } settings)
# layerrule = blur, match:namespace ^(rofi|wofi|waybar)$

# If ignorezero still exists (check wiki!) – otherwise remove these lines
# layerrule = ignorezero, match:namespace ^(rofi|wofi)$

# Alternative compact syntax seen in recent configs
# layerrule = ignorezero, rofi           ← remove if it errors
